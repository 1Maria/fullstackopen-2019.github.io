{"data":{"markdownRemark":{"html":"<div class=\"content\">\n<p>Ennen kuin siirrymmen osan varsinaiseen aiheeseen, eli tiedon tallettamiseen tietokantaan, tarkastellaan muutamaa tapaa Node-sovellusten debuggaamiseen.</p>\n<h3>Node-sovellusten debuggaaminen</h3>\n<p>Nodella tehtyjen sovellusten debuggaaminen on jossain määrin hankalampaa kuin selaimessa toimivan Javascriptin. Vanha hyvä keino on tietysti konsoliin tulostelu. Se kannattaa aina. On mielipiteitä, joiden mukaan konsoliin tulostelun sijaan olisi syytä suosia jotain kehittyneempää menetelmää, mutta en ole ollenkaan samaa mieltä. Jopa maailman aivan eliittiin kuuluvat open source -kehittäjät <a href=\"https://tenderlovemaking.com/2016/02/05/i-am-a-puts-debuggerer.html\">käyttävät</a> tätä <a href=\"https://swizec.com/blog/javascript-debugging-slightly-beyond-console-log/swizec/6633\">menetelmää</a>.</p>\n<h4>Visual Studio Code</h4>\n<p>Visual Studio Coden debuggeri voi olla hyödyksi joissain tapauksissa. Saat käynnistettyä sovelluksen debuggaustilassa seuraavasti</p>\n<picture><img src=\"/static/d5be104ee40f9e3c2793b288c15d50dc/14be6/35.png\" srcset=\"/static/d5be104ee40f9e3c2793b288c15d50dc/4cce7/35.png 200w,\n/static/d5be104ee40f9e3c2793b288c15d50dc/bae5f/35.png 400w,\n/static/d5be104ee40f9e3c2793b288c15d50dc/14be6/35.png 800w,\n/static/d5be104ee40f9e3c2793b288c15d50dc/1b35a/35.png 1200w,\n/static/d5be104ee40f9e3c2793b288c15d50dc/9ee03/35.png 1600w,\n/static/d5be104ee40f9e3c2793b288c15d50dc/b6ad2/35.png 1880w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Huomaa, että sovellus ei saa olla samalla käynnissä \"normaalisti\" konsolista, sillä tällöin sovelluksen käyttämä portti on varattu.</p>\n<p>Seuraavassa screenshot, missä koodi on pysäytetty kesken uuden muistiinpanon lisäyksen</p>\n<picture><img src=\"/static/47274d6ad3595488a2525b0392c87765/14be6/36a.png\" srcset=\"/static/47274d6ad3595488a2525b0392c87765/4cce7/36a.png 200w,\n/static/47274d6ad3595488a2525b0392c87765/bae5f/36a.png 400w,\n/static/47274d6ad3595488a2525b0392c87765/14be6/36a.png 800w,\n/static/47274d6ad3595488a2525b0392c87765/1b35a/36a.png 1200w,\n/static/47274d6ad3595488a2525b0392c87765/9ee03/36a.png 1600w,\n/static/47274d6ad3595488a2525b0392c87765/22997/36a.png 2040w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Koodi on pysähtynyt nuolen osoittaman <i>breakpointin</i> kohdalle ja konsoliin on evaluoitu muuttujan <i>note</i> arvo. Vasemmalla olevassa ikkunassa on nähtävillä myös muuta ohjelman tilaan liittyvää.</p>\n<p>Ylhäällä olevista nuolista yms. voidaan kontrolloida debuggauksen etenemistä.</p>\n<p>Itse en jostain syystä juurikaan käytä Visual Studio Coden debuggeria.</p>\n<h4>Chromen dev tools</h4>\n<p>Debuggaus onnisuu myös Chromen developer-konsolilla, käynnistämällä sovellus komennolla:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">node --inspect index.js</code></pre></div>\n<p>Debuggeriin pääsee käsiksi klikkaamalla chromen devloper-konsoliin ilmestyneestä vihreästä ikonista</p>\n<picture><img src=\"/static/98eea9ee4f184a484417314745f7422a/14be6/37.png\" srcset=\"/static/98eea9ee4f184a484417314745f7422a/4cce7/37.png 200w,\n/static/98eea9ee4f184a484417314745f7422a/bae5f/37.png 400w,\n/static/98eea9ee4f184a484417314745f7422a/14be6/37.png 800w,\n/static/98eea9ee4f184a484417314745f7422a/1b35a/37.png 1200w,\n/static/98eea9ee4f184a484417314745f7422a/9ee03/37.png 1600w,\n/static/98eea9ee4f184a484417314745f7422a/5e830/37.png 1688w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Debuggausnäkymä toimii kuten React-koodia debugattaessa, <i>Sources</i>-välilehdelle voidaan esim. asettaa breakpointeja, eli kohtia joihin suoritus pysähtyy:</p>\n<picture><img src=\"/static/c0ebc516f43538e6e93a966b50162262/14be6/38.png\" srcset=\"/static/c0ebc516f43538e6e93a966b50162262/4cce7/38.png 200w,\n/static/c0ebc516f43538e6e93a966b50162262/bae5f/38.png 400w,\n/static/c0ebc516f43538e6e93a966b50162262/14be6/38.png 800w,\n/static/c0ebc516f43538e6e93a966b50162262/1b35a/38.png 1200w,\n/static/c0ebc516f43538e6e93a966b50162262/9ee03/38.png 1600w,\n/static/c0ebc516f43538e6e93a966b50162262/e1a7a/38.png 1962w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Kaikki sovelluksen console.log-tulostukset tulevat debuggerin <i>Console</i>-välilehdelle. Voit myös tutkia siellä muuttujien arvoja ja suorittaa mielivaltaista Javascript-koodia:</p>\n<picture><img src=\"/static/7f0509f9db5e7930ca9a98a1c1b21e2b/14be6/39.png\" srcset=\"/static/7f0509f9db5e7930ca9a98a1c1b21e2b/4cce7/39.png 200w,\n/static/7f0509f9db5e7930ca9a98a1c1b21e2b/bae5f/39.png 400w,\n/static/7f0509f9db5e7930ca9a98a1c1b21e2b/14be6/39.png 800w,\n/static/7f0509f9db5e7930ca9a98a1c1b21e2b/1b35a/39.png 1200w,\n/static/7f0509f9db5e7930ca9a98a1c1b21e2b/9ee03/39.png 1600w,\n/static/7f0509f9db5e7930ca9a98a1c1b21e2b/227d8/39.png 1934w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<h4>Epäile kaikkea</h4>\n<p>Full Stack -sovellusten debuggaaminen vaikuttaa alussa erittäin hankalalta. Kun kohta kuvaan tulee myös tietokanta ja frontend on yhdistetty backendiin, on potentiaalisia virhelähteitä todella paljon.</p>\n<p>Kun sovellus \"ei toimi\", onkin selvitettävä missä vika on. On erittäin yleistä, että vika on sellaisessa paikassa, mitä ei osaa ollenkaan epäillä, ja menee minuutti-, tunti- tai jopa päiväkausia ennen kuin oikea ongelmien lähde löytyy.</p>\n<p>Avainasemassa onkin systemaattisuus. Koska virhe voi olla melkein missä vain, <i>kaikkea pitää epäillä</i>, ja tulee pyrkiä poissulkemaan ne osat tarkastelusta, missä virhe ei ainakaan ole. Konsoliin kirjoitus, Postman, debuggeri ja kokemus auttavat.</p>\n<p>Virheiden ilmaantuessa <i>ylivoimaisesti huonoin strategia</i> on jatkaa koodin kirjoittamista. Se on tae siitä, että koodissa on pian kymmenen ongelmaa lisää ja niiden syyn selvittäminen on entistäkin vaikeampaa. Toyota Production Systemin periaate <a href=\"http://gettingtolean.com/toyota-principle-5-build-culture-stopping-fix/#.Wjv9axP1WCQ\">Stop and fix</a> toimii tässäkin yhteydessä paremmin kuin hyvin.</p>\n<h3>MongoDB</h3>\n<p>Jotta saisimme talletettua muistiinpanot pysyvästi, tarvitsemme tietokannan. Useimmilla laitoksen kursseilla on käytetty relaatiotietokantoja. Tällä kurssilla käytämme <a href=\"https://www.mongodb.com/\">MongoDB</a>:tä, joka on ns. <a href=\"https://en.wikipedia.org/wiki/Document-oriented_database\">dokumenttitietokanta</a>.</p>\n<p>Dokumenttitietokannat poikkeavat jossain määrin relaatiotietokannoista niin datan organisointitapansa kuin kyselykielensäkin suhteen. Dokumenttitietokantojen ajatellaan kuuluvan sateenvarjotermin <a href=\"https://en.wikipedia.org/wiki/NoSQL\">NoSQL</a> alle. Lisää dokumenttitietokannoista ja NoSQL:stä Tietokantojen perusteiden <a href=\"https://tikape-s18.mooc.fi/part7/\">viikon 7 materiaalista</a>.</p>\n<p><strong>Lue nyt Tietokantojen perusteiden dokumenttitietokantoja kuvaava osuus.</strong> Jatkossa oletetaan, että hallitset käsitteet <i>dokumentti</i> ja <i>kokoelma</i> (collection).</p>\n<p>MongoDB:n voi luonnollisesti asentaa omalle koneelle. Internetistä löytyy kuitenkin myös palveluna toimivia Mongoja, joista tämän hetken paras valinta on <a href=\"https://www.mongodb.com/cloud/atlas\">MongoDB Atlas</a>.</p>\n<blockquote>\n<p><i>Jos ehdit jo konfiguroida itsellesi mlabin, löydät ohjeita sen käyttöön <a href=\"https://fullstackopen.github.io/osa3/\">viime vuoden materiaalista</a>.</i></p>\n</blockquote>\n<p>Kun käyttäjätili on luotu ja kirjauduttu, Atlas kehoittaa luomaan klusterin:</p>\n<picture><img src=\"/static/eb76cc9c7abe028a28fd91fddac12466/14be6/57.png\" srcset=\"/static/eb76cc9c7abe028a28fd91fddac12466/4cce7/57.png 200w,\n/static/eb76cc9c7abe028a28fd91fddac12466/bae5f/57.png 400w,\n/static/eb76cc9c7abe028a28fd91fddac12466/14be6/57.png 800w,\n/static/eb76cc9c7abe028a28fd91fddac12466/1b35a/57.png 1200w,\n/static/eb76cc9c7abe028a28fd91fddac12466/9ee03/57.png 1600w,\n/static/eb76cc9c7abe028a28fd91fddac12466/8003f/57.png 1836w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Valitaan <i>AWS</i> ja <i>Frankfurt</i> ja luodaan klusteri.</p>\n<picture><img src=\"/static/517709f56808d0b57ebd9a974a1af519/14be6/58.png\" srcset=\"/static/517709f56808d0b57ebd9a974a1af519/4cce7/58.png 200w,\n/static/517709f56808d0b57ebd9a974a1af519/bae5f/58.png 400w,\n/static/517709f56808d0b57ebd9a974a1af519/14be6/58.png 800w,\n/static/517709f56808d0b57ebd9a974a1af519/1b35a/58.png 1200w,\n/static/517709f56808d0b57ebd9a974a1af519/9ee03/58.png 1600w,\n/static/517709f56808d0b57ebd9a974a1af519/15613/58.png 1710w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Odotetaan että klusteri on valmiina, tähän menee noin 10 minuuttia. </p>\n<p><strong>HUOM</strong> älä jatka eteenpäin ennen kun klusteri on valmis!</p>\n<p>Luodaan <i>security</i> välilehdeltä tietokantakäyttäjätunnus joka on siis eri tunnus kuin se, jonka avulla kirjaudutaan MongoDB Atlasiin:</p>\n<picture><img src=\"/static/36093728926e24d6df20ddd63ebe9a0f/14be6/59.png\" srcset=\"/static/36093728926e24d6df20ddd63ebe9a0f/4cce7/59.png 200w,\n/static/36093728926e24d6df20ddd63ebe9a0f/bae5f/59.png 400w,\n/static/36093728926e24d6df20ddd63ebe9a0f/14be6/59.png 800w,\n/static/36093728926e24d6df20ddd63ebe9a0f/1b35a/59.png 1200w,\n/static/36093728926e24d6df20ddd63ebe9a0f/9ee03/59.png 1600w,\n/static/36093728926e24d6df20ddd63ebe9a0f/0980a/59.png 1856w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>annetaan käyttäjälle luku- ja kirjoitustoikeus kaikkiin tietokantoihin</p>\n<picture><img src=\"/static/df119e4306c0102df432e1d9d75ba285/14be6/60.png\" srcset=\"/static/df119e4306c0102df432e1d9d75ba285/4cce7/60.png 200w,\n/static/df119e4306c0102df432e1d9d75ba285/bae5f/60.png 400w,\n/static/df119e4306c0102df432e1d9d75ba285/14be6/60.png 800w,\n/static/df119e4306c0102df432e1d9d75ba285/1b35a/60.png 1200w,\n/static/df119e4306c0102df432e1d9d75ba285/b1255/60.png 1526w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p><strong>HUOM</strong> muutamissa tapauksissa uusi käyttäjä ei ole toiminut heti luomisen jälkeen. On saattanut kestää jopa useita minuutteja ennen kuin käyttäjätunnus on ruvennut toimimaan.</p>\n<p>Seuraavaksi tulee määritellä ne ip-osoitteet, joista tietokantaan pääsee käsiksi</p>\n<picture><img src=\"/static/6bd9e7d3140b9262d9919a451125daaf/14be6/61.png\" srcset=\"/static/6bd9e7d3140b9262d9919a451125daaf/4cce7/61.png 200w,\n/static/6bd9e7d3140b9262d9919a451125daaf/bae5f/61.png 400w,\n/static/6bd9e7d3140b9262d9919a451125daaf/14be6/61.png 800w,\n/static/6bd9e7d3140b9262d9919a451125daaf/1b35a/61.png 1200w,\n/static/6bd9e7d3140b9262d9919a451125daaf/9ee03/61.png 1600w,\n/static/6bd9e7d3140b9262d9919a451125daaf/676a5/61.png 1828w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Sallitaan yksinkertaisuuden vuoksi yhteydet kaikkialta:</p>\n<picture><img src=\"/static/6eb9d9ccbbd931b09258a5b6944da209/14be6/62.png\" srcset=\"/static/6eb9d9ccbbd931b09258a5b6944da209/4cce7/62.png 200w,\n/static/6eb9d9ccbbd931b09258a5b6944da209/bae5f/62.png 400w,\n/static/6eb9d9ccbbd931b09258a5b6944da209/14be6/62.png 800w,\n/static/6eb9d9ccbbd931b09258a5b6944da209/1b35a/62.png 1200w,\n/static/6eb9d9ccbbd931b09258a5b6944da209/599db/62.png 1354w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n<p>Lopultakin ollaan valmiina ottamaan tietokantayhteyden. Valitaan <i>Connect your application</i> ja <i>Short SRV connection string</i></p>\n<picture><img src=\"/static/6111c05c94c5b33e618c47dc1b6048e4/14be6/64.png\" srcset=\"/static/6111c05c94c5b33e618c47dc1b6048e4/4cce7/64.png 200w,\n/static/6111c05c94c5b33e618c47dc1b6048e4/bae5f/64.png 400w,\n/static/6111c05c94c5b33e618c47dc1b6048e4/14be6/64.png 800w,\n/static/6111c05c94c5b33e618c47dc1b6048e4/1b35a/64.png 1200w,\n/static/6111c05c94c5b33e618c47dc1b6048e4/07092/64.png 1336w\" sizes=\"(max-width: 800px) 100vw, 800px\"></picture>\n</div>","frontmatter":{"mainImage":{"publicURL":"/static/part-3-8ac7bc0fb2b7018a7853b00c454b2103.svg"},"part":3,"letter":"c","lang":"fi"}}},"pageContext":{"part":3,"letter":"c","lang":"fi"}}